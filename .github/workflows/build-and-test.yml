
# Github Actions で自動テストを行う方法を記述したものです。

name: Build and Test

on: push

env:
  BUILD_TYPE: RelWithDebInfo
#  BUILD_TYPE: Debug

jobs:
  build-and-test:

    runs-on: ${{matrix.os}}

    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest, macos-latest, ubuntu-18.04]

    steps:

    - name: SSH Setting for private repository
      env:
        PRIVATE_TOKEN: ${{secrets.KEY_TO_ACCESS_FBXSDK}}
      run: |
        mkdir -p /home/runner/.ssh/
        echo -e "$TOKEN" > /home/runner/.ssh/id_rsa
        chmod 600 /home/runner/.ssh/id_rsa

    - uses: actions/checkout@v3
      with:
        submodules: true
        lfs: true

    - name: Build
      uses: ./.github/actions/build
      with:
        shell_type: ${{ (runner.os == 'Windows' && 'powershell') || 'bash' }}

    - name: Run Test
      run: |
        cd ${{github.workspace}}/out/build/x64-Release/bin
        ./plateau_test

    - name: Run Test of C# Wrapper
      run: |
        cd ${{github.workspace}}/wrappers/csharp/LibPLATEAU.NET
        dotnet test -p:Configuration=Release -p:Platform="Any CPU" --verbosity normal ${{github.workspace}}/wrappers/csharp/LibPLATEAU.NET
